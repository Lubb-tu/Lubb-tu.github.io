<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ø§Ø¸Ø± Ø§Ù„Ù„ÙØ¸ÙŠ</title>
    <link rel="shortcut icon" type="image/png" href="lubb-white.svg" class="logo">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="game-ar.css">
    <audio id="alertSound" src="https://assets.mixkit.co/active_storage/sfx/2865/2865-preview.mp3"></audio>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="shortcut icon" type="image/png" href="lubb-ar-word.svg" class="logo">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="shortcut icon" type="image/png" href="lubb-white.svg" class="logo">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=National+Park:wght@200..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://www.fontstatic.com/f=amiri-quran" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <section id="sidebar">
        <!-- Sidebar -->
        <div class="sidebar close">
            <header>
              <div class="image-text">
                <div class="text header-text">
                  <img  class="lubb" src="lubb-blue.svg" style=" width: 70px; margin-right: -2px; margin-top: 10px;">
                  <span class="profession"><h4>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ø§Ø¸Ø± Ø§Ù„Ù„ÙØ¸ÙŠ</h4></span>
                </div>
              </div>

            </header>
            <div class="menu-bar">
              <div class="menu">
                <ul class="menu-links">
                  <li><a href="./Lubb_AR"><i class='bx bx-home icon'></i><span class="text">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a></li>
                  <li><a href="./Verbal_Analogy_Quiz_AR"><i class='bx bx-message-square-add icon'></i><span class="text">ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©</span></a></li>
                  <li><a href="./Verbal_Analogy_Quiz_EN"><i class='bx bx-globe icon'></i><span class="text en">English</span></a></li>
                </ul>
              </div>
          
              <div class="bottom-content">
                <li class="mode">
                        <div class="moon-sun">
                            <i class='bx bx-moon icon moon'></i>
                            <i class='bx bx-sun icon sun'></i>
                          </div>
                          <span class="mode-text text">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†</span>
  
                          <div class="toggle-switch">
                              <span class="switch"></span>
                          </div>
                  </li>
              </div>
            </div>
</section>

    <div id="model" class="model-box">
        <button class="model-btn"><span class="label">DeepSeek R1</span></button>
    </div>

    <!-- Configuration Screen -->
    <div class="popup config-popup active" id="config-popup">
        <div class="config-container">
            <h1>ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
            <h3>Ø­Ø¯Ø¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©</h3>
            <div class="category-options">
                <div class="category-option active" data-difficulty="Ø§Ù„Ø³Ù‡Ù„" data-time="60">Ø³Ù‡Ù„</div>
                <div class="category-option" data-difficulty="Ø§Ù„Ù…ØªÙˆØ³Ø·" data-time="45">Ù…ØªÙˆØ³Ø·</div>
                <div class="category-option" data-difficulty="Ø§Ù„ØµØ¹Ø¨" data-time="30">ØµØ¹Ø¨</div>
            </div>
            <h3>Ø­Ø¯Ø¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
            <div class="question-options">
                <div class="question-option">5</div>
                <div class="question-option active">10</div>
                <div class="question-option">15</div>
                <div class="question-option">20</div>
                <div class="question-option">25</div>
            </div>
            <button class="start-quiz-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div class="popup quiz-popup">
        <div class="quiz-container">
            <header class="quiz-header">
                <h2 class="quiz-title">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ø§Ø¸Ø± Ø§Ù„Ù„ÙØ¸ÙŠ</h2>
                <div class="quiz-timer">
                    <div class="timer-duration"></div>
                    <span><i class='bx bx-stopwatch icon'></i></span>
                </div>
            </header>
            <div class="question-text">Q</div>
            <ul class="answer-options"></ul>
            <div class="quiz-footer">
                <p class="question-status">Ø§Ù„Ø³Ø¤Ø§Ù„ <span class="current-question">1</span> Ù…Ù† <span class="total-questions">10</span></p>
                <button class="next-question-btn">
                    Ø§Ù„ØªØ§Ù„ÙŠ <box-icon name='right-arrow-alt icon'></box-icon>
                </button>
            </div>
        </div>
    </div>

    <!-- Result Screen -->
    <div class="popup result-popup">
        <div class="result-container">
            <h2>ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ø§ÙƒÙ…Ù„Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!</h2>
            <div class="result-stars">
                <div class="star-container">
                    <span class="star">â˜†</span>
                    <span class="star">â˜†</span>
                    <span class="star">â˜†</span>
                </div>
            </div>
            <div class="result-message"></div>
            <div class="result-footer">
                <button id="showExplanationsBtn" class="explanation-btn">ğŸ’¡Ø´Ø±Ø­ Ø§Ù„Ø£Ø¬ÙˆØ¨Ø©</button>
                <button  class="try-again-btn">â†ªï¸Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>    
            </div>
            <div id="explanationsContainer" class="explanations-container">
                <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø´Ø±ÙˆØ­Ø§Øª -->
                <div class="explanations-content">
                    <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±ÙˆØ­Ø§Øª Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                </div>
            </div>
            <div class="explanations-footer">
                <button  class="try-again-btn2">â†ªï¸Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button> 
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">
            ØªØ­Ø¶ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span id="difficultyLabel">Ø§Ù„Ø³Ù‡Ù„</span>...<br>
            <small>Ø¥Ù†Ø´Ø§Ø¡ <span id="questionCountLabel">5</span> Ø£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</small>
        </div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingBar"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@tsparticles/confetti@3.0.3/tsparticles.confetti.bundle.min.js"></script>    
    <script>
        // DOM Elements
        const answerOptions = document.querySelector(".answer-options");
        const nextQuestionBtn = document.querySelector(".next-question-btn");
        const currentQuestionNum = document.querySelector(".current-question");
        const totalQuestionNum = document.querySelector(".total-questions");
        const timerDisplay = document.querySelector(".timer-duration");
        const questionText = document.querySelector(".question-text");
        const questionStatus = document.querySelector(".question-status");
        const li = document.createElement('li');
        li.className = 'answer-option'; // Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø© Ù‡Ù†Ø§

        // Quiz State
        let selectedDifficulty = "Ø³Ù‡Ù„";
        let selectedTime = 60;
        let totalQuestions = 5;
        let currentQuestionIndex = 0;
        let score = 0;
        let timerInterval = null;
        let answerSelected = false;
        let currentQuestions = [];
        let previousQuestions = [];
        let allExplanations = [];
        // API Config
        const DEEPSEEK_API_KEY = "sk-c0ea48210bc1401abcff35336a53a5a0";

        // Loading Screen Elements
        const loadingOverlay = document.getElementById("loadingOverlay");
        const difficultyLabel = document.getElementById("difficultyLabel");
        const questionCountLabel = document.getElementById("questionCountLabel");
        const loadingBar = document.getElementById("loadingBar");

        // Quiz State
        let quizAttempt = 1;
        let gameState = { difficulty: "Ø³Ù‡Ù„", totalQuestions: 5 };

        const body = document.querySelector("body");
        const sidebar = document.querySelector(".sidebar");
        const modeSwitch = document.querySelector(".toggle-switch");
        const modeText = document.querySelector(".mode-text");

        // Toggle sidebar width
        sidebar.addEventListener('click', () => {
            sidebar.classList.toggle('close');
        });
        function updateModeUI() {
            const isDark = body.classList.contains("dark");
            modeText.innerText = isDark ? "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­" : "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†";
        }
        
        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
        modeSwitch.addEventListener("click", () => {
            body.classList.toggle("dark");
            updateModeUI();
    
            // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ¶Ø¹ ÙÙŠ localStorage
            if (body.classList.contains("dark")) {
                localStorage.setItem("theme", "dark");
            } else {
                localStorage.setItem("theme", "light");
            }
        });
    

         
        // Event Listeners
        document.querySelectorAll('.category-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.category-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
                selectedDifficulty = option.dataset.difficulty;
                selectedTime = parseInt(option.dataset.time); // Ù‡Ù†Ø§ ÙŠØªÙ… Ø£Ø®Ø° Ø§Ù„ÙˆÙ‚Øª Ù…Ù† Ø§Ù„Ø³Ù…Ø©
                
                // ØªØ­Ø¯ÙŠØ« gameState
                gameState = {
                    difficulty: selectedDifficulty,
                    totalQuestions: gameState.totalQuestions,
                    time: selectedTime
                };
                
                // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø®ØªØ§Ø± (Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡)
                document.querySelector('.selected-time').textContent = selectedTime + 'second';
            });
        });

        document.querySelectorAll('.question-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.question-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                totalQuestions = parseInt(option.textContent);
                gameState.totalQuestions = totalQuestions;
            });
        });
        document.getElementById('showExplanationsBtn').addEventListener('click', function () {
        const explanations = document.getElementById('explanationsContainer');
        const isVisible = explanations.style.display === 'block';

        // ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙˆØ­Ø§Øª
        explanations.style.display = isVisible ? 'none' : 'block';

        const retryBtn2 = document.querySelector('.try-again-btn2');
        if (retryBtn2) {
            retryBtn2.style.display = isVisible ? 'none' : 'block';
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¹Ù†Ø¯ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±ÙˆØ­Ø§Øª
        document.querySelectorAll('.result-stars, .result-message, h2,  .try-again-btn , .explanation-btn').forEach(el => {
            el.style.display = isVisible ? '' : 'none';
        });
               
        });
  
        document.querySelector(".start-quiz-btn").addEventListener('click', startQuiz);
        document.querySelector(".try-again-btn").addEventListener('click', () => {
            quizAttempt++;
            resetQuiz();
        });
        document.querySelector(".try-again-btn2").addEventListener('click', () => {
            quizAttempt++;
            resetQuiz();
        });

        nextQuestionBtn.addEventListener('click', nextQuestionHandler);
    

        function generatePrompt(difficulty, numQuestions, attempt = 1) {
            let prompt = `ØªÙˆÙ„ÙŠØ¯ ${numQuestions} Ø£Ø³Ø¦Ù„Ø© ØªÙ†Ø§Ø¸Ø± Ù„ÙØ¸ÙŠ ÙØ±ÙŠØ¯Ø© Ø¨Ø§Ù„ØµÙŠØºØ© JSON. `;
            prompt += `Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ù‡Ùˆ: ${difficulty}. Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø¹Ø§ÙŠÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ÙÙ‚Ø·.\n`;
            prompt += `ØªØ¬Ù†Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø£Ùˆ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.\n`;
            prompt += `Ø§Ù„Ù…ÙØ¹Ø±Ù Ø§Ù„ÙØ±ÙŠØ¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØªØ¬Ø±Ø¨Ø©: ${Math.random().toString(36).substring(2, 10)}\n`;
            prompt += `Ø±ÙƒØ² Ø¹Ù„Ù‰ ØªÙ†ÙˆØ¹ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª ÙÙŠ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©.\n`;
            prompt += `ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙŠ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ÙˆØ§Ø­Ø¯.\n`;
            prompt += `ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† ÙƒÙ„ Ø³Ø¤Ø§Ù„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ø¨Ø¹Ø© Ø®ÙŠØ§Ø±Ø§ØªØŒ ÙˆÙƒÙ„ Ø®ÙŠØ§Ø± ÙŠØ³ØªØ®Ø¯Ù… Ù†ÙˆØ¹ Ø¹Ù„Ø§Ù‚Ø© Ù…Ø®ØªÙ„ÙØ©ØŒ Ù…Ø«Ù„: Ø§Ù„Ù…Ø±Ø§Ø¯ÙØ§ØªØŒ Ø§Ù„Ø£Ø¶Ø¯Ø§Ø¯ØŒ Ø§Ù„Ø¬Ø²Ø¡-Ø§Ù„ÙƒÙ„ØŒ Ø§Ù„Ø³Ø¨Ø¨-Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŒ Ø§Ù„Ø­ÙŠÙˆØ§Ù†-Ø§Ù„ØµÙˆØªØŒ Ø§Ù„Ø¹Ø§ØµÙ…Ø©-Ø§Ù„Ø¯ÙˆÙ„Ø©ØŒ Ø§Ù„Ù†Ù…ÙˆØŒ ÙˆØºÙŠØ±Ù‡Ø§. \n`;
            prompt += `ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† ÙƒÙ„ Ø®ÙŠØ§Ø± Ø®Ø§Ø·Ø¦ ÙŠØ³ØªØ®Ø¯Ù… Ù†ÙˆØ¹ Ø¹Ù„Ø§Ù‚Ø© Ù…Ø®ØªÙ„Ù Ø¹Ù† Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ¹Ù† Ø¨Ø¹Ø¶Ù‡Ø§ Ø§Ù„Ø¨Ø¹Ø¶.`;
            const examples = {
                easy: `Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ù‡Ù„Ø©:
                    - **Ø§Ù„ØªØ±ÙƒÙŠØ²:** Ø³Ø±Ø¹Ø© Ø§Ù„Ø±Ø¨Ø· Ø¨ÙŠÙ† Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.
                    - **Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹:** Ø£Ù„ÙˆØ§Ù† â†” Ø£Ø´ÙŠØ§Ø¡ Ù…Ù…ÙŠØ²Ø© Ø¨Ù‡Ø§ØŒ Ø£ÙƒÙ„ â†” Ø¨Ù„Ø¯ Ù…Ø´Ù‡ÙˆØ±ØŒ Ø¬Ù…Ø§Ø¯ â†” Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙŠÙˆÙ…ÙŠ.
                    - **Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª:**
                    - Ø¹Ù„Ø§Ù‚Ø© Ù…Ø¨Ø§Ø´Ø±Ø© (Ù…Ø«Ù„: Ø£Ø¨ÙŠØ¶ â†” Ø­Ù„ÙŠØ¨).
                    - Ø§Ø±ØªØ¨Ø§Ø· Ø«Ù‚Ø§ÙÙŠ (Ù…Ø«Ù„: Ø§Ù„ÙŠØ§Ø¨Ø§Ù† â†” Ø³ÙˆØ´ÙŠ).
                    - ÙˆØ¸ÙŠÙØ© Ø¨Ø³ÙŠØ·Ø© (Ù…Ø«Ù„: Ù…Ù‚Øµ â†” Ù‚Ø·Ø¹).`,
                medium: `Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©:
                        - **Ø§Ù„ØªØ±ÙƒÙŠØ²:** Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ Ø§Ù„Ø¨Ø³ÙŠØ· ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©.
                        - **Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹:** ØªØ¶Ø§Ø¯/ØªØ±Ø§Ø¯ÙØŒ Ø¬Ø²Ø¡ â†” ÙƒÙ„ØŒ Ø¹Ù„Ø§Ù‚Ø§Øª Ù…ÙƒØ§Ù†ÙŠØ© (Ø¯Ø§Ø®Ù„/Ø®Ø§Ø±Ø¬)ØŒ ØµÙØ§Øª â†” Ø£Ø´ÙŠØ§Ø¡.
                        - **Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª:**
                        - Ø§Ø±ØªØ¨Ø§Ø· ÙˆØ¸ÙŠÙÙŠ (Ù…Ø«Ù„: Ù…ÙØªØ§Ø­ â†” Ù‚ÙÙ„).
                        - Ø¹Ù„Ø§Ù‚Ø© Ø¬Ø²Ø¡ÙŠØ© (Ù…Ø«Ù„: ÙˆØ±Ù‚Ø© â†” ÙƒØªØ§Ø¨).
                        - ØªØ¶Ø§Ø¯ ØºÙŠØ± Ù…Ø¨Ø§Ø´Ø± (Ù…Ø«Ù„: Ù†Ø§Ø± â†” Ø¬Ù„ÙŠØ¯).
                        `,
                hard: `Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØµØ¹Ø¨Ø©:
                    - **Ø§Ù„ØªØ±ÙƒÙŠØ²:** Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù…Ø¬Ø±Ø¯ ÙˆØ§Ù„Ø±Ø¨Ø· ØºÙŠØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±.
                    - **Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹:** ØªÙ„Ù…ÙŠØ­Ø§Øª Ø¹Ø§Ø·ÙÙŠØ©ØŒ ØªØ´Ø§Ø¨Ù‡ Ù…Ø¬Ø§Ø²ÙŠØŒ Ø¹Ù„Ø§Ù‚Ø§Øª ØºÙŠØ± Ù…Ø£Ù„ÙˆÙØ© (Ù…Ø«Ù„: Ù„ÙˆÙ† â†” Ø´Ø¹ÙˆØ±ØŒ Ø¹Ù†ØµØ± â†” Ø±Ù…Ø²ÙŠØ©).
                    - **Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª:**
                    - ØªØ´Ø§Ø¨Ù‡ ÙÙŠ Ø§Ù„Ø³Ù…Ø© Ø§Ù„Ù…Ø¬Ø±Ø¯Ø© (Ù…Ø«Ù„: Ø°Ù‡Ø¨ â†” Ø´Ù…Ø³ [Ù„Ù…Ø¹Ø§Ù†]).
                    - Ø§Ø±ØªØ¨Ø§Ø· Ø³ÙŠØ§Ù‚ÙŠ Ø¹Ù…ÙŠÙ‚ (Ù…Ø«Ù„: Ù‚Ù‡ÙˆØ© â†” ØµØ¨Ø§Ø­ [Ø¹Ø§Ø¯Ø© ÙŠÙˆÙ…ÙŠØ©]).
                    - Ø¹Ù„Ø§Ù‚Ø© ØªØ£Ø«ÙŠØ± (Ù…Ø«Ù„: Ù…Ø·Ø± â†” Ø­ÙŠØ§Ø© [Ø§Ù„Ù…Ø§Ø¡ Ø£Ø³Ø§Ø³ Ø§Ù„Ø­ÙŠØ§Ø©]).`
             };
            prompt += `Ø§Ù„Ø£Ù…Ø«Ù„Ø©:\n`;
            prompt += `- Ø³Ù‡Ù„: ${examples.easy}\n`;
            prompt += `- Ù…ØªÙˆØ³Ø·: ${examples.medium}\n`;
            prompt += `- ØµØ¹Ø¨: ${examples.hard}\n`;
            prompt += `Ø§Ø¨ØªÙƒØ§Ø± Ø¹Ù„Ø§Ù‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ØºÙŠØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø£Ø¹Ù„Ø§Ù‡. Ø§Ù‡ØªÙ… Ø¨Ø¹Ù„Ø§Ù‚Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø© Ø¨ÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ù…ØªØ±Ø§Ø¯ÙØ© Ø§Ùˆ Ø¹Ù„Ø§Ù‚Ø© ØªØ¶Ø§Ø¯ Ø£Ùˆ Ø¬Ø²Ø¡ Ù…Ù† ÙƒÙ„ Ø£Ùˆ Ù…Ù† Ø¥Ù„Ù‰ (ØªØ­ÙˆÙ„)Ø£Ùˆ Ù…ØµÙ†ÙˆØ¹ Ù…Ù† Ø£Ùˆ ÙŠØªÙƒÙˆÙ† Ù…Ù† Ù…Ø§Ø°Ø§ØŸ Ø£Ùˆ Ø¨Ù„Ø§Ø¯ ÙˆØ¹ÙˆØ§ØµÙ… Ø£Ùˆ Ø§Ù„ÙˆØ§Ù† Ø£Ùˆ Ø£Ø¯ÙˆØ§Øª Ø£Ùˆ Ø¹Ù„ÙˆÙ… ÙˆØªÙ‚Ù†ÙŠØ© Ø£Ùˆ Ø«Ù‚Ø§ÙØ© Ø£Ùˆ Ø§ÙƒÙ„Ø§Øª Ø£Ùˆ Ø³ÙŠØ§Ø­Ø© ÙÙŠ Ù…Ø®ØªÙ„Ù Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ø­ÙŠØ§Ø© 
            Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØµØ¹ÙˆØ¨Ø©:
            - Ø³Ù‡Ù„:
            * Ø¹Ù„Ø§Ù‚Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© (Ù…ØªØ±Ø§Ø¯ÙØ§ØªØŒ Ø¬Ø²Ø¡ Ù…Ù† ÙƒÙ„ØŒ ÙˆØ¸Ø§Ø¦Ù Ø£Ø³Ø§Ø³ÙŠØ©).
            * Ø£Ù…Ø«Ù„Ø©: 'Ù…ÙØªØ§Ø­ : Ø³ÙŠØ§Ø±Ø©' (Ø¬Ø²Ø¡ Ù…Ù† ÙƒÙ„)ØŒ 'Ø´Ù…Ø³ : Ù†ÙˆØ±' (Ø³Ø¨Ø¨ ÙˆÙ†ØªÙŠØ¬Ø©).
            - Ù…ØªÙˆØ³Ø·:
            * Ø¹Ù„Ø§Ù‚Ø§Øª Ø³ÙŠØ§Ù‚ÙŠØ©/ÙˆØ¸ÙŠÙÙŠØ© Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„ØªØ¹Ù‚ÙŠØ¯.
            * Ø£Ù…Ø«Ù„Ø©: 'Ø¨Ù†Ø²ÙŠÙ† : Ù…Ø­Ø±Ùƒ' (Ù…ØµØ¯Ø± Ø·Ø§Ù‚Ø©)ØŒ 'ÙƒØªØ§Ø¨ : Ù…ÙƒØªØ¨Ø©' (Ù…ÙƒØ§Ù† ØªØ®Ø²ÙŠÙ†).
            - ØµØ¹Ø¨:
            * Ø¹Ù„Ø§Ù‚Ø§Øª Ù…Ø¬Ø±Ø¯Ø©/Ù…ØªØ®ØµØµØ©/Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø·Ø¨Ù‚Ø§Øª.
            * Ø£Ù…Ø«Ù„Ø©: 'Ø³Ø®Ø±ÙŠØ© : Ù†Ù‚Ø¯' (Ø£Ø¯Ø§Ø© Ù„ØºÙˆÙŠØ©)ØŒ 'Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© : Ù…Ø´ÙƒÙ„Ø©' (Ø­Ù„ Ù…Ø¹Ù‚Ø¯).
            `;
            prompt += `
            Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù…Ù†ÙˆØ¹Ø© Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©: 
            - Ø³Ù‡Ù„: ØªØ¬Ù†Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ø²ÙŠØ© Ø£Ùˆ Ø§Ù„Ù…Ø¬Ø±Ø¯Ø©.
            - Ù…ØªÙˆØ³Ø·: ØªØ¬Ù†Ø¨ Ø§Ù„Ù…ØªØ±Ø§Ø¯ÙØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø£Ùˆ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ø¨Ø¯ÙŠÙ‡ÙŠØ©.
            - ØµØ¹Ø¨: ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø§Ù„Ù…Ø§Ø¯ÙŠØ© Ø£Ùˆ Ø§Ù„Ø³ÙŠØ§Ù‚Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.
            `;
            prompt += `ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù…Ù‚Ø¨ÙˆÙ„Ø© ÙˆØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØªØ±ØªÙŠØ¨ Ø«Ø§Ø¨Øª (X : Y â‰  Y : X).\n`;
            prompt += ` Ù‡Ø§Ù… Ø¬Ø¯Ø§ : ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«Ø© ØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­Ø© Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø¹Ù„Ø§Ù‚Ø§Øª Ù…Ø®ØªÙ„ÙØ© ØªÙ…Ø§Ù…Ù‹Ø§ Ø¹Ù† Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø²ÙˆØ¬ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙƒÙ„ Ø¹Ù„Ø§Ù‚Ø© ÙÙŠ Ù…Ø¬Ø§Ù„ Ù…Ø®ØªÙ„Ù Ø§Ùˆ Ù„Ù‡Ø§ ØªØ¹Ø±ÙŠÙ ÙˆÙˆØµÙ Ù…Ø®ØªÙ„Ù.\n`;
            prompt += `ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 0-3 ØŒ ÙˆØªÙƒÙˆÙ† Ù…ØªÙ†ÙˆØ¹Ø© Ù„ÙŠØ³Øª Ù…Ø­ØµÙˆØ±Ø© ÙÙŠ Ø±Ù‚Ù… Ù…Ø¹ÙŠÙ†`;
            prompt += `Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø±Ù‚Ù…: ${attempt}.\n`;
            prompt += `Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØªÙ… Ø±ÙØ¶ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø§Ù„ØªÙŠ Ù„Ø§ ØªØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØµØ¹ÙˆØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.\n`;
            prompt += ` Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±Ø· Ø¥Ù„Ø²Ø§Ù…ÙŠ ÙˆÙŠØ¬Ø¨ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù‡ Ø¨Ø¯Ù‚Ø©.
                        ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† ÙƒÙ„ Ø³Ø¤Ø§Ù„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ø¨Ø¹Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø°Ø§Øª Ø¹Ù„Ø§Ù‚Ø§Øª Ù…Ù†Ø·Ù‚ÙŠØ© Ù…Ø®ØªÙ„ÙØ© ØªÙ…Ø§Ù…Ù‹Ø§.
                        ÙŠØ¬Ø¨ Ø£Ù† ØªØ´ØªØ±Ùƒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø²ÙˆØ¬ Ø§Ù„Ø³Ø¤Ø§Ù„ØŒ
                        Ø¨ÙŠÙ†Ù…Ø§ ÙŠØ¬Ø¨ Ø£Ù† ØªÙ…Ø«Ù„ ÙƒÙ„ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø© Ø¹Ù„Ø§Ù‚Ø© Ù…Ù†Ø·Ù‚ÙŠØ© Ù…Ø®ØªÙ„ÙØ©ØŒ Ù…Ø«Ù„:
                        - Ù…Ø±Ø§Ø¯ÙØ§Øª
                        - Ø£Ø¶Ø¯Ø§Ø¯
                        - Ø¬Ø²Ø¡-ÙƒÙ„
                        - ÙƒÙ„-Ø¬Ø²Ø¡
                        - Ø³Ø¨Ø¨-Ù†ØªÙŠØ¬Ø©
                        - Ø£Ø¯Ø§Ø©-ÙˆØ¸ÙŠÙØ©
                        - Ø£Ø¯Ø§Ø©-ÙØ¹Ù„
                        - Ù…Ù‡Ù†Ø©-Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„
                        - Ù„ÙˆÙ†-ÙƒØ§Ø¦Ù†
                        - Ø¯ÙˆÙ„Ø©-Ø¹Ø§ØµÙ…Ø©
                        - Ù…Ù†ØªØ¬-Ù…ØµØ¯Ø±
                        - ØµÙˆØª-Ø­ÙŠÙˆØ§Ù†
                        ØªØ¬Ù†Ø¨ ØªÙƒØ±Ø§Ø± Ù†Ù…Ø· Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ù†ÙØ³Ù‡ Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ø³Ø¤Ø§Ù„.
                        ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ© ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ù‚Ø¨ÙˆÙ„Ø©.
                        \n`;
            prompt += `ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…Ø¤Ø´Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© (correctIndex) ÙŠØªØºÙŠØ± Ø¨ÙŠÙ† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆÙ„Ø§ ÙŠÙƒÙˆÙ† Ø¯Ø§Ø¦Ù…Ù‹Ø§ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± correctIndex ÙÙŠ Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø®ØªÙ„ÙØ© (0, 1, 2, Ø£Ùˆ 3) Ø¹Ø¨Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. ØªØ¬Ù†Ø¨ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø´ÙƒÙ„ Ù…ØªÙƒØ±Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…ÙƒØ§Ù†. Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±Ø· Ø¥Ù„Ø²Ø§Ù…ÙŠ ÙˆÙŠØ¬Ø¨ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù‡ Ø¨Ø¯Ù‚Ø©.\n`;
            
            prompt +=
             `Required format:
                    [
                        {
                            "question": ["word1", "word2"],
                            "options": [
                                ["option1_word1", "option1_word2"],
                                ["option2_word1", "option2_word2"],
                                ["option3_word1", "option3_word2"],
                                ["option4_word1", "option4_word2"]
                            ],
                            "correctIndex": 2
                            "explanation":" Ø§Ø´Ø±Ø­ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø¹Ù…Ù‚ ÙˆØ§Ø´Ø±Ø­  Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨ÙŠÙ† Ø²ÙˆØ¬ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø«Ù… Ø­Ø¯Ø¯ Ù„Ù…Ø§Ø°Ø§ Ø§Ø®ØªØ±Øª Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø§Ù„ØµØ­ÙŠØ­ ÙˆÙ„Ù…Ø§Ø°Ø§ Ù„Ù… ØªØ®ØªØ§Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ù„Ù…Ø§Ø°Ø§ Ù‡ÙŠ Ø®Ø§Ø·Ø¦Ø©."

                        }
                    ]
                  Return ONLY the JSON array with no other text.`;

                return prompt;
            }
        // Core Functions
       
        function safeJsonParse(str) {
            try {
                return JSON.parse(str);
            } catch (e) {
                console.error("JSON ØºÙŠØ± ØµØ§Ù„Ø­:", str);
                return [];
            }
        }
        async function fetchDeepSeek(prompt, temperature = 1.3) {
            try {
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "user", content: prompt }],
                        temperature,
                        max_tokens: 6000
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const rawJson = data.choices[0].message.content.trim();
                console.log("Raw JSON response:", rawJson); // ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                return safeJsonParse(rawJson);
            } catch (error) {
                console.error("Error fetching questions:", error);
                return [];
            }
        }
        function filterUniqueQuestions(questions) {
            const seenRelations = new Set();
            return questions.filter(q => {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ© (Ù„ÙŠØ³ ÙÙ‚Ø· Ø§Ù„ÙƒÙ„Ù…Ø§Øª)
                const relationKey = `${q.question[0]}-${q.question[1]}-${q.options.flat().join("-")}`;
                if (seenRelations.has(relationKey)) return false;
                seenRelations.add(relationKey);
                return true;
            });
        }

        function showLoadingScreen() {
            const loadingContent = `
                <div class="loading-spinner"></div>
                <div class="loading-text">
                ØªØ­Ø¶ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰  ${gameState.difficulty}<br>
                    <small>Ø¥Ù†Ø´Ø§Ø¡ ${gameState.totalQuestions} Ø£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</small>
                </div>
                <div class="loading-progress">
                    <div class="loading-progress-bar"></div>
                </div>
            `;
            
            loadingOverlay.innerHTML = loadingContent;
            document.body.appendChild(loadingOverlay);
            loadingOverlay.style.display = 'flex';
        }

        function hideLoadingScreen() {
            loadingOverlay.style.display = 'none';
        }

        function simulateLoadingProgress() {
            const progressBar = loadingOverlay.querySelector('.loading-progress-bar');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                progressBar.style.width = Math.min(progress, 90) + '%';
                
                if (progress >= 90) {
                    clearInterval(interval);
                }
            }, 500);
        }

        async function startQuiz() {
            nextQuestionBtn.style.opacity = '0';
            // â† Ø¥ÙØ±Ø§Øº Ø§Ù„Ù…ØµÙÙˆÙØ© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            previousQuestions = [];
            currentQuestions = [];
            allExplanations = [];
            // ØªØ­Ø¯ÙŠØ« gameState
            gameState.difficulty = document.querySelector('.category-option.active').dataset.difficulty;
            gameState.totalQuestions = parseInt(document.querySelector('.question-option.active').textContent);

            // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            showLoadingScreen();
            simulateLoadingProgress();

            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            document.querySelector(".config-popup").classList.remove("active");
            document.querySelector(".quiz-popup").classList.add("active");

            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ Prompt
            const prompt = generatePrompt(
                gameState.difficulty,
                gameState.totalQuestions,
                quizAttempt
            );

            try {
                currentQuestions = await fetchDeepSeek(prompt);
                
                if (!currentQuestions.length) {
                    alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
                    return;
                }

                // ØªØµÙÙŠØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±Ø©
                currentQuestions = filterUniqueQuestions(currentQuestions);
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
                previousQuestions = [...previousQuestions, ...currentQuestions];

                // Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                currentQuestionIndex = 0;
                score = 0;
                showQuestion();

            } finally {
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                hideLoadingScreen();
            }
        }

        function showQuestion() {
            nextQuestionBtn.style.opacity = '0';
            const question = currentQuestions[currentQuestionIndex];
            currentQuestionNum.textContent = currentQuestionIndex + 1;
            totalQuestionNum.textContent = currentQuestions.length;
            questionText.textContent = `${question.question[0]} : ${question.question[1]} :: ØŸ`;
            questionStatus.innerHTML = `Ø§Ù„Ø³Ø¤Ø§Ù„ <span class="current-question">${currentQuestionIndex + 1}</span> Ù…Ù† <span class="total-questions">${currentQuestions.length}</span>`;

            answerOptions.innerHTML = '';
            question.options.forEach((option, index) => {
                const li = document.createElement('li');
                li.className = 'answer-option';
                li.textContent = `${option[0]} : ${option[1]}`;
                li.onclick = () => handleAnswer(li, index, question.correctIndex);
                answerOptions.appendChild(li);
            });

            startTimer(question.correctIndex);
        }

        // ÙÙŠ Ø¯Ø§Ù„Ø© handleAnswer Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:
        function handleAnswer(element, selectedIndex, correctIndex) {
            if (answerSelected) return;
            answerSelected = true;
            
            element.classList.add(selectedIndex === correctIndex ? 'correct' : 'incorrect');
            
            // Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ù„ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.add('disabled');
            });
            
            if (selectedIndex === correctIndex) score++;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±Ø­
            const explanation = currentQuestions[currentQuestionIndex].explanation;  // assuming explanation is part of question object
            const explanationContainer = document.getElementById('explanationsContainer');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯
            explanationContainer.innerHTML = '';
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±Ø­ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            explanationContainer.innerHTML = explanation ? explanation : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±Ø­ Ù…ØªØ§Ø­.";
            
            setTimeout(nextQuestionHandler, 500);
            clearInterval(timerInterval);
        }



        function startTimer(correctIndex = null){
            const timerElement = document.querySelector('.quiz-timer');
            const alertSound = document.getElementById('alertSound');
            
            timerElement.style.backgroundColor = '';
            timeLeft = selectedTime;
            answerSelected = false;
            nextQuestionBtn.disabled = true;
            alertSound.load();

            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeLeft--;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø£ÙˆÙ„Ø§Ù‹
                timerDisplay.textContent = 
                    timeLeft >= 60 
                        ? `${Math.floor(timeLeft / 60)}:${(timeLeft % 60).toString().padStart(2, '0')}`
                        : `${timeLeft}s`;

                // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø«Ø§Ù†ÙŠØ© 1
                if (timeLeft === 1) {
                    alertSound.currentTime = 0;
                    alertSound.play();
                }

                // Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆÙ‚Øª
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerElement.style.backgroundColor = '#ff4444';

                    const options = document.querySelectorAll('.answer-option');
                    
                    options.forEach((opt, index) => {
                        opt.style.pointerEvents = 'none';
                        opt.classList.add('expired');
                        // ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
                        if (index === correctIndex) {
                            opt.classList.add('correct');
                        }
                    });

                    nextQuestionBtn.disabled = false;
                    nextQuestionBtn.style.opacity = '1';
                    answerSelected = true; // Ù…Ù†Ø¹ Ø£ÙŠ Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø¹Ø¯ Ø§Ù„ÙˆÙ‚Øª
                }

            }, 1000);
        }

        function nextQuestionHandler() {
            nextQuestionBtn.style.opacity = '0';
            currentQuestionIndex++;
            currentQuestionIndex < currentQuestions.length ? showQuestion() : showResults();
        }

        function showResults() {
            const count = 200,
            defaults = {
                origin: { y: 0.7 },
            };

            function fire(particleRatio, opts) {
            confetti(
                Object.assign({}, defaults, opts, {
                particleCount: Math.floor(count * particleRatio),
                })
            );
            }

            fire(0.25, {
            spread: 26,
            startVelocity: 55,
            });

            fire(0.2, {
            spread: 60,
            });

            fire(0.35, {
            spread: 100,
            decay: 0.91,
            scalar: 0.8,
            });

            fire(0.1, {
            spread: 120,
            startVelocity: 25,
            decay: 0.92,
            scalar: 1.2,
            });

            fire(0.1, {
            spread: 120,
            startVelocity: 45,
            });
            document.querySelector(".quiz-popup").classList.remove("active");
            document.querySelector(".result-popup").classList.add("active");

            // âœ… Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            const retryBtn2 = document.querySelector('.try-again-btn2');
            if (retryBtn2) {
                retryBtn2.style.display = 'none';
            }
            
            const percentage = (score / currentQuestions.length) * 100;
            const stars = document.querySelectorAll('.star');
            
            // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø¬ÙˆÙ…
            let starCount = 0;
            if (percentage >= 90) starCount = 3;
            else if (percentage >= 60) starCount = 2;
            else if (percentage >= 30) starCount = 1;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¬ÙˆÙ…
            stars.forEach((star, index) => {
                if (index < starCount) {
                    star.classList.add('filled');
                    star.innerHTML = 'â˜…'; // Ù†Ø¬Ù…Ø© Ù…Ù…Ù„ÙˆØ¡Ø©
                } else {
                    star.classList.remove('filled');
                    star.innerHTML = 'â˜†'; // Ù†Ø¬Ù…Ø© ÙØ§Ø±ØºØ©
                }
            });
            
            document.querySelector(".result-message").innerHTML = `
                <h2 class="result-title">
                    ${percentage >= 80 ? "Ù…Ù…ØªØ§Ø²! ğŸ‰" : 
                    percentage >= 50 ? "Ø£Ø­Ø³Ù†Øª! ğŸ‘" : 
                    "Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§! ğŸ’ª"}
                </h2>
                <p class="result-stats">
                    Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: ${currentQuestions.length}/${score} 
                    (${percentage.toFixed(1)}%)
                </p>
            `;
            const container = document.getElementById("explanationsContainer");
            container.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø¯ÙŠÙ…

            currentQuestions.forEach((question, index) => {
                const explanationDiv = document.createElement("div");
                explanationDiv.className = "explanation-item";
                explanationDiv.innerHTML = `
                    <h3>Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}: ${question.question.join(" : ")}</h3>
                    <p><strong>Ø§Ù„Ø´Ø±Ø­:</strong> ${question.explanation || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±Ø­ Ù…ØªÙˆÙØ±."}</p>
                `;
                container.appendChild(explanationDiv);
            });
            

        }

        function resetQuiz() {
            // Hide all popups
            document.querySelectorAll('.popup').forEach(popup => {
                popup.classList.remove('active');
            });
            
            // Show configuration screen
            document.querySelector(".config-popup").classList.add("active");
            
            // Reset quiz state variables
            currentQuestionIndex = 0;
            score = 0;
            answerSelected = false;
            currentQuestions = [];
            previousQuestions = [];
            allExplanations = [];
            
            // Clear any active timers
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Reset UI elements
            // 1. Quiz Screen
            document.querySelector('.quiz-title').style.display = 'block';
            document.querySelector('.question-text').style.display = 'block';
            answerOptions.innerHTML = '';
            nextQuestionBtn.style.opacity = '0';
            timerDisplay.textContent = '';
            
            // 2. Result Screen
            const resultElements = document.querySelectorAll('.result-stars, .result-message, h2, .try-again-btn, .explanation-btn');
            resultElements.forEach(el => el.style.display = '');
            
            // Reset stars
            document.querySelectorAll('.star').forEach(star => {
                star.innerHTML = 'â˜†';
                star.classList.remove('filled');
            });
            
            // Hide explanations
            document.getElementById('explanationsContainer').style.display = 'none';
            document.querySelector('.explanations-content').innerHTML = '';
            
            // 3. Re-enable answer options
            document.querySelectorAll('.answer-option').forEach(option => {
                option.classList.remove('correct', 'incorrect', 'disabled');
                option.style.pointerEvents = 'auto';
            });
            
            // 4. Reset progress display
            currentQuestionNum.textContent = '1';
            totalQuestionNum.textContent = '10';
        }
    </script>
</body>
</html>